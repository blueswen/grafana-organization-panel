# Test info

- Name: Organization Panel - Button Mode >> should generate buttons for all organizations
- Location: /home/runner/work/grafana-organization-panel/grafana-organization-panel/tests/panel.spec.ts:21:7

# Error details

```
Error: page.waitForSelector: Test timeout of 30000ms exceeded.
Call log:
  - waiting for locator('div[data-testid="data-testid panel content"]') to be visible

    at /home/runner/work/grafana-organization-panel/grafana-organization-panel/tests/panel.spec.ts:13:16
```

# Page snapshot

```yaml
- link "Skip to main content":
  - /url: "#pageContent"
- banner:
  - link "Grafana":
    - /url: /
    - img "Grafana"
  - log
  - img
  - text: Main Org.
  - combobox "Change organization"
  - img
  - img
  - button "Search or jump to..."
  - img
  - text: ctrl+k
  - button "New":
    - img
    - img
  - button "Help":
    - img
  - button "News":
    - img
  - button "Profile":
    - img "User avatar"
  - button "Open menu":
    - img
  - navigation "Breadcrumbs":
    - list:
      - listitem:
        - link "Home":
          - /url: /
      - listitem:
        - link "Dashboards":
          - /url: /dashboards
      - listitem:
        - link "Provisioned organization panel dashboard":
          - /url: /d/a538aeff-5a8a-42a5-901c-938d896fdd6f/provisioned-organization-panel-dashboard?orgId=1
      - listitem: Edit panel
  - button "Discard"
  - button "Save"
  - button "Apply"
  - button "Toggle top search bar":
    - img
- main:
  - text: Table view
  - checkbox "toggle-table-view"
  - radiogroup:
    - radio "Fill" [checked]
    - text: Fill
    - radio "Actual"
    - text: Actual
  - 'button "Time range selected: Last 6 hours"':
    - img
    - text: Last 6 hours
    - img
  - button "Zoom out time range":
    - img
  - button "Refresh dashboard":
    - img
  - heading "Organization panel with button" [level=6]
  - button "Alpha Org."
  - button "Beta Org."
  - button "Delta Org."
  - button "Epsilon Org."
  - button "Eta Org."
  - button "Gamma Org."
  - button "Iota Org."
  - button "Main Org."
  - button "Theta Org."
  - button "Zeta Org."
  - tablist:
    - tab "Tab Query" [selected]:
      - img
      - text: Query1
    - tab "Tab Transform data":
      - img
      - text: Transform data0
  - text: Data source
  - img "-- Grafana -- logo"
  - textbox "Select a data source"
  - img
  - button "Open data source help":
    - img
  - button "Expand query row":
    - img
  - text: Query options MD = auto = 848 Interval = 30s
  - button "Query inspector button": Query inspector
  - button "Collapse query row" [expanded]:
    - img
  - button "Query editor row title A": A
  - emphasis: (-- Grafana --)
  - button "Duplicate query":
    - img
  - button "Hide response":
    - img
  - button "Remove query":
    - img
  - button "Drag and drop to reorder":
    - img "Drag and drop to reorder"
  - text: Query type
  - log
  - text: Random Walk
  - combobox
  - img
  - button "Add query":
    - img
    - text: Add query
  - button "Change Visualization":
    - text: Organization Panel
    - img
  - button "Close options pane":
    - img
  - img
  - textbox "Search options"
  - button "Options group Panel options toggle" [expanded]:
    - img
  - heading "Panel options" [level=6]
  - text: Title
  - textbox: Organization panel with button
  - text: Description
  - textbox
  - text: Transparent background
  - checkbox "Toggle switch"
  - button "Options group Panel links toggle":
    - img
  - heading "Panel links" [level=6]
  - button "Options group Repeat options toggle":
    - img
  - heading "Repeat options" [level=6]
  - button "Options group Organization Panel toggle" [expanded]:
    - img
  - heading "Organization Panel" [level=6]
  - text: Display mode
  - radiogroup:
    - radio "Select"
    - text: Select
    - radio "Button" [checked]
    - text: Button
    - radio "Collapsible Button"
    - text: Collapsible Button
```

# Test source

```ts
   1 | import { test, expect } from '@grafana/plugin-e2e';
   2 | import { getGrafanaBootData, switchOrg, getOrgList, getPanelContentSelector } from './utils';
   3 |
   4 | test.describe('Organization Panel - Button Mode', () => {
   5 |   test.beforeEach(async ({ page, gotoPanelEditPage, readProvisionedDashboard }) => {
   6 |     // Switch to the Main Org.
   7 |     await switchOrg(page, 1);
   8 |
   9 |     const dashboard = await readProvisionedDashboard({ fileName: 'dashboard.json' });
   10 |     await gotoPanelEditPage({ dashboard, id: '2' });
   11 |
   12 |     // Wait for the organization panel to be visible
>  13 |     await page.waitForSelector('div[data-testid="data-testid panel content"]');
      |                ^ Error: page.waitForSelector: Test timeout of 30000ms exceeded.
   14 |   });
   15 |
   16 |   test.afterEach(async ({ page }) => {
   17 |     // Switch back to the Main Org.
   18 |     await switchOrg(page, 1);
   19 |   });
   20 |
   21 |   test('should generate buttons for all organizations', async ({ page }) => {
   22 |     // Get the list of organizations
   23 |     const orgList = await getOrgList(page);
   24 |
   25 |     // Check if the buttons are generated
   26 |     const buttons = await page.locator('button[data-testid^="org-"]');
   27 |     await expect(buttons).toHaveCount(orgList.length);
   28 |
   29 |     // Check if the buttons have the correct text and data-testid
   30 |     for (const org of orgList) {
   31 |       const button = page.locator(`button[data-testid="org-${org.id}"]`);
   32 |       await expect(button).toHaveText(org.name);
   33 |     }
   34 |   });
   35 |
   36 |   test('should highlight the current user organization', async ({ page }) => {
   37 |     // Get the current organization ID
   38 |     const grafanaBootData = await getGrafanaBootData(page);
   39 |     expect(grafanaBootData.user).toHaveProperty('orgId');
   40 |     const currentOrgId = grafanaBootData.user.orgId;
   41 |
   42 |     // Check if the button is active
   43 |     const button = page.locator(`button[data-testid="org-${currentOrgId}"]`);
   44 |     await expect(button).toHaveClass(/active/);
   45 |   });
   46 |
   47 |   test('should switch organization when clicking a button', async ({ page }) => {
   48 |     const grafanaBootData = await getGrafanaBootData(page);
   49 |     const currentOrgId = grafanaBootData.user.orgId;
   50 |
   51 |     // Switch to a different organization
   52 |     const orgButtons = await page.locator('button[data-testid^="org-"]').all();
   53 |     let newOrgId = '';
   54 |     for (const button of orgButtons) {
   55 |       const orgId = await button.getAttribute('data-testid');
   56 |       if (orgId != null && orgId !== `org-${currentOrgId}`) {
   57 |         newOrgId = orgId.replace('org-', '');
   58 |         console.log(`Redirect to org: ${newOrgId}`);
   59 |         await button.click();
   60 |         await page.waitForURL((url) => url.searchParams.get('orgId') === orgId.replace('org-', ''));
   61 |         break;
   62 |       }
   63 |     }
   64 |
   65 |     if (newOrgId === '') {
   66 |       throw new Error('Failed to find a different organization');
   67 |     }
   68 |
   69 |     // Check if the organization has been switched
   70 |     const newGrafanaBootData = await getGrafanaBootData(page);
   71 |     expect(newGrafanaBootData.user.orgId.toString()).toBe(newOrgId);
   72 |   });
   73 | });
   74 |
   75 | test.describe('Organization Panel - Select Mode', () => {
   76 |   test.beforeEach(async ({ page, gotoPanelEditPage, readProvisionedDashboard }) => {
   77 |     // Switch to the Main Org.
   78 |     await switchOrg(page, 1);
   79 |
   80 |     const dashboard = await readProvisionedDashboard({ fileName: 'dashboard.json' });
   81 |     await gotoPanelEditPage({ dashboard, id: '1' });
   82 |
   83 |     // Wait for the organization panel to be visible
   84 |     await page.waitForSelector('div[data-testid="data-testid panel content"]');
   85 |   });
   86 |
   87 |   test.afterEach(async ({ page }) => {
   88 |     // Switch back to the Main Org.
   89 |     await switchOrg(page, 1);
   90 |   });
   91 |
   92 |   test('should generate options for all organizations', async ({ page, selectors }) => {
   93 |     // Get the list of organizations
   94 |     const orgList = await getOrgList(page);
   95 |
   96 |     const { panel, input } = getPanelContentSelector(page);
   97 |     await expect(panel).toBeVisible();
   98 |     await input.click();
   99 |     
  100 |     const menuId = await input.getAttribute('aria-controls');
  101 |     const options = page.locator(`#${menuId} [role="option"] span`);
  102 |     await expect(options).toHaveCount(orgList.length);
  103 |
  104 |     // Check if the options have the correct text
  105 |     for (let i = 0; i < orgList.length; i++) {
  106 |       const option = options.nth(i);
  107 |       const optionText = await option.textContent();
  108 |       expect(optionText).toBe(orgList[i].name);
  109 |     }
  110 |   });
  111 |
  112 |   test('should select the current user organization', async ({ page }) => {
  113 |     // Get the current organization ID
```